<%- include('../templates/header') %>

<main>
    <section class="container page-section">
        <h1 class="page-title">Modificar Cita (Admin)</h1>
        
        <div class="booking-form-container card">
            
            <form id="recepcionistaEditBookingForm" action="/recepcionista/editar-cita/<%= cita._id %>" method="POST">
                
                <div id="step1" class="form-step active">
                    <h2>Paso 1: Paciente</h2>
                    <div class="form-group">
                        <label for="patientSearch">Buscar Paciente (o cambiar)</label>
                        <input type="text" id="patientSearch" class="form-control" value="<%= cita.paciente.nombre %>">
                    </div>
                    <div id="patientResults" class="list-group" style="margin-top: 1rem;"></div>
                    
                    <input type="hidden" id="selectedPatientId" name="pacienteId" value="<%= cita.paciente._id %>" required>
                    <input type="hidden" id="selectedPatientName" value="<%= cita.paciente.nombre %>">

                    <a href="/recepcionista/gestionar-citas" class="btn btn-secondary">Cancelar</a>
                    <button type="button" class="btn btn-primary" id="btnNextStep1" onclick="nextStep(2)">Siguiente</button>
                </div>

                <div id="step2" class="form-step">
                    <h2>Paso 2: Datos de la Cita</h2>
                    <div class="form-group">
                        <label for="specialty">Especialidad</label>
                        <select id="specialty" name="specialty" class="form-control" required>
                            <option value="">Selecciona...</option>
                            <% especialidades.forEach(esp => { %>
                                <option value="<%= esp %>" 
                                    <%= (esp === cita.medico.especialidad) ? 'selected' : '' %>>
                                    <%= esp %>
                                </option>
                            <% }); %>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="doctor">Médico</label>
                        <select id="doctor" name="doctor" class="form-control" required data-medico-id="<%= cita.medico._id %>">
                            <option value="">Cargando...</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="date">Fecha</label>
                        <input type="date" id="date" name="date" class="form-control" value="<%= fechaParaInput %>" required>
                    </div>
                    <div class="time-slots" id="timeSlotsContainer">
                        <p>Horas disponibles:</p>
                    </div>
                    <input type="hidden" id="selectedTime" name="time" value="<%= cita.hora %>" required>
                    
                    <button type="button" class="btn btn-secondary" onclick="prevStep(1)">Anterior</button>
                    <button type="button" class="btn btn-primary" onclick="nextStep(3)">Siguiente</button>
                </div>

                <div id="step3" class="form-step">
                    <h2>Paso 3: Confirmar Cambios</h2>
                    <div class="summary">
                        <p><strong>Paciente:</strong> <span id="summary-patient">...</span></p> 
                        <p><strong>Especialidad:</strong> <span id="summary-specialty">...</span></p>
                        <p><strong>Médico:</strong> <span id="summary-doctor">...</span></p>
                        <p><strong>Fecha y Hora:</strong> <span id="summary-datetime">...</span></p>
                    </div>
                    <div class="form-group">
                        <label for="reason">Motivo (opcional)</label>
                        <textarea id="reason" name="reason" rows="3" class="form-control"><%= cita.motivo %></textarea>
                    </div>
                    <button type="button" class="btn btn-secondary" onclick="prevStep(2)">Anterior</button>
                    <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                </div>
            </form>
        </div>
    </section>
</main>

<%- include('../templates/footer') %>

<script src="/js/recepcionista-editar-cita.js"></script>