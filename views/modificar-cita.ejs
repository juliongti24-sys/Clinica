<%- include('templates/header') %> 
    <main>
        <section class="container page-section">
            <h1 class="page-title">Modificar Cita</h1>
            <div class="booking-form-container card">
                
                <form id="bookingForm" action="/citas/modificar/<%= cita._id %>" method="POST">
                
                    <div id="step1" class="form-step active"> [cite: 16]
                        <h2>Paso 1: Elige una especialidad</h2>
                        <div class="form-group">
                            <label for="specialty">Especialidad</label>
                            
                            <select id="specialty" name="specialty" class="form-control" required>
                                <option value="">Selecciona una especialidad...</option>
                                <% especialidades.forEach(esp => { %>
                                    <option value="<%= esp %>" 
                                        <%= (esp === cita.medico.especialidad) ? 'selected' : '' %>>
                                        <%= esp %>
                                    </option>
                                <% }); %>
                            </select>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="nextStep(2)">Siguiente</button> [cite: 19]
                    </div>

                    <div id="step2" class="form-step"> [cite: 38]
                        <h2>Paso 2: Elige médico y fecha</h2>
                        <div class="form-group">
                            <label for="doctor">Médico</label>
                            
                            <select id="doctor" name="doctor" class="form-control" required
                                    data-medico-id="<%= cita.medico._id %>"> <option value="">Cargando médicos...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="date">Fecha</label>
                            <input type="date" id="date" name="date" class="form-control" required 
                                   [cite_start]value="<%= fechaParaInput %>"> [cite: 24, 42]
                        </div>
                        
                        <div class="time-slots" id="timeSlotsContainer">
                            <p>Horas disponibles:</p>
                        </div>
                        
                        <input type="hidden" id="selectedTime" name="time" required 
                               value="<%= cita.hora %>">
                        
                        <button type="button" class="btn btn-secondary" onclick="prevStep(1)">Anterior</button>
                        <button type="button" class="btn btn-primary" onclick="nextStep(3)">Siguiente</button>
                    </div>

                    <div id="step3" class="form-step"> [cite: 27, 45]
                        <h2>Paso 3: Confirma tus cambios</h2>
                        <div class="summary">
                            <p><strong>Especialidad:</strong> <span id="summary-specialty">...</span></p>
                            <p><strong>Médico:</strong> <span id="summary-doctor">...</span></p>
                            <p><strong>Fecha y Hora:</strong> <span id="summary-datetime">...</span></p>
                            <p><strong>Paciente:</strong> <%= usuario.nombre %></p>
                        </div>
                        <div class="form-group">
                            <label for="reason">Motivo de la consulta (opcional)</label>
                            <textarea id="reason" name="reason" rows="3" class="form-control"><%= cita.motivo %></textarea> [cite: 29, 47]
                        </div>
                        <button type="button" class="btn btn-secondary" onclick="prevStep(2)">Anterior</button> [cite: 30, 48]
                        <button type="submit" class="btn btn-primary">Guardar Cambios</button>
                    </div>
                </form>
            </div>
        </section>
    </main>
    
    <script src="/js/modificar-cita.js"></script>
<%- include('templates/footer') %> 
